{"id":"trD0","dependencies":[{"name":"/Users/alberttian/f21/playground/frontend/live_video/node_modules/@tensorflow/tfjs-backend-webgl/dist/max_pool_backprop_gpu.js.map","includedInParent":true,"mtime":1631991247369},{"name":"/Users/alberttian/f21/playground/frontend/live_video/package.json","includedInParent":true,"mtime":1633056435183},{"name":"/Users/alberttian/f21/playground/frontend/live_video/.babelrc","includedInParent":true,"mtime":1633056216691},{"name":"/Users/alberttian/f21/playground/frontend/live_video/node_modules/@tensorflow/tfjs-backend-webgl/package.json","includedInParent":true,"mtime":1631991247369}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.MaxPool3DBackpropProgram=exports.MaxPool2DBackpropProgram=void 0;class n{constructor(n){this.variableNames=[\"dy\",\"maxPos\"],this.outputShape=n.inShape;const t=n.strideHeight,o=n.strideWidth,e=n.dilationHeight,i=n.effectiveFilterHeight,d=n.effectiveFilterWidth,r=i-1-n.padInfo.top,a=d-1-n.padInfo.left,s=i*d-1;this.userCode=`\\n      const ivec2 pads = ivec2(${r}, ${a});\\n\\n      void main() {\\n        ivec4 coords = getOutputCoords();\\n        int b = coords[0];\\n        int d = coords[3];\\n\\n        ivec2 dyRCCorner = coords.yz - pads;\\n        int dyRCorner = dyRCCorner.x;\\n        int dyCCorner = dyRCCorner.y;\\n\\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\\n        // ? = to be determined. : = across all values in that axis.\\n        float dotProd = 0.0;\\n        for (int wR = 0; wR < ${i};\\n          wR += ${e}) {\\n          float dyR = float(dyRCorner + wR) / ${t}.0;\\n\\n          if (dyR < 0.0 || dyR >= ${n.outHeight}.0 || fract(dyR) > 0.0) {\\n            continue;\\n          }\\n          int idyR = int(dyR);\\n\\n          for (int wC = 0; wC < ${d}; wC++) {\\n            float dyC = float(dyCCorner + wC) / ${o}.0;\\n\\n            if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||\\n                fract(dyC) > 0.0) {\\n              continue;\\n            }\\n            int idyC = int(dyC);\\n\\n            float dyValue = getDy(b, idyR, idyC, d);\\n            int maxPosValue = ${s} - int(getMaxPos(b, idyR, idyC, d));\\n\\n            // Get the current value, check it against the value from the\\n            // position matrix.\\n            int curPosValue = wR * ${d} + wC;\\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\\n\\n            dotProd += dyValue * mask;\\n          }\\n        }\\n        setOutput(dotProd);\\n      }\\n    `}}exports.MaxPool2DBackpropProgram=n;class t{constructor(n){this.variableNames=[\"dy\",\"maxPos\"],this.outputShape=n.inShape;const t=n.strideDepth,o=n.strideHeight,e=n.strideWidth,i=n.dilationDepth,d=n.dilationHeight,r=n.dilationWidth,a=n.effectiveFilterDepth,s=n.effectiveFilterHeight,y=n.effectiveFilterWidth,c=a-1-n.padInfo.front,l=s-1-n.padInfo.top,C=y-1-n.padInfo.left,f=a*s*y-1;this.userCode=`\\n      const ivec3 pads = ivec3(${c}, ${l}, ${C});\\n\\n      void main() {\\n        ivec5 coords = getOutputCoords();\\n        int batch = coords.x;\\n        int ch = coords.u;\\n\\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\\n        int dyDCorner = dyCorner.x;\\n        int dyRCorner = dyCorner.y;\\n        int dyCCorner = dyCorner.z;\\n\\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\\n        // dx(xD, xR, xC, ch).\\n        // ? = to be determined. : = across all values in that axis.\\n        float dotProd = 0.0;\\n\\n        for (int wD = 0; wD < ${a};\\n           wD += ${i}) {\\n          float dyD = float(dyDCorner + wD) / ${t}.0;\\n\\n          if (dyD < 0.0 || dyD >= ${n.outDepth}.0 || fract(dyD) > 0.0) {\\n            continue;\\n          }\\n          int idyD = int(dyD);\\n\\n          for (int wR = 0; wR < ${s};\\n              wR += ${d}) {\\n            float dyR = float(dyRCorner + wR) / ${o}.0;\\n\\n            if (dyR < 0.0 || dyR >= ${n.outHeight}.0 ||\\n                fract(dyR) > 0.0) {\\n              continue;\\n            }\\n            int idyR = int(dyR);\\n\\n            for (int wC = 0; wC < ${y};\\n                wC += ${r}) {\\n              float dyC = float(dyCCorner + wC) / ${e}.0;\\n\\n              if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||\\n                  fract(dyC) > 0.0) {\\n                continue;\\n              }\\n              int idyC = int(dyC);\\n\\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\\n              int maxPosValue = ${f} -\\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\\n\\n              // Get the current value, check it against the value from the\\n              // position matrix.\\n              int curPosValue =\\n                  wD * ${s} * ${y} +\\n                  wR * ${y} + wC;\\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\\n\\n              dotProd += dyValue * mask;\\n            }\\n          }\\n        }\\n        setOutput(dotProd);\\n      }\\n    `}}exports.MaxPool3DBackpropProgram=t;"},"sourceMaps":{"js":{"mappings":[{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":88,"column":37},"generated":{"line":1,"column":0}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":88,"column":37},"generated":{"line":1,"column":13}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":88,"column":37},"generated":{"line":1,"column":20}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":88,"column":37},"generated":{"line":1,"column":35}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":88,"column":37},"generated":{"line":1,"column":43}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":88,"column":37},"generated":{"line":1,"column":56}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":88,"column":37},"generated":{"line":1,"column":57}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":88,"column":37},"generated":{"line":1,"column":64}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":88,"column":37},"generated":{"line":1,"column":68}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":88,"column":37},"generated":{"line":1,"column":76}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":88,"column":37},"generated":{"line":1,"column":101}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":88,"column":37},"generated":{"line":1,"column":109}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":88,"column":37},"generated":{"line":1,"column":139}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":21,"column":6},"generated":{"line":1,"column":141}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":21,"column":13},"generated":{"line":1,"column":147}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":26,"column":2},"generated":{"line":1,"column":149}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":26,"column":14},"generated":{"line":1,"column":161}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":22,"column":2},"generated":{"line":1,"column":164}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":22,"column":2},"generated":{"line":1,"column":169}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":22,"column":18},"generated":{"line":1,"column":183}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":22,"column":19},"generated":{"line":1,"column":184}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":22,"column":25},"generated":{"line":1,"column":189}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":27,"column":9},"generated":{"line":1,"column":199}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":27,"column":9},"generated":{"line":1,"column":204}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":27,"column":23},"generated":{"line":1,"column":216}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":27,"column":32},"generated":{"line":1,"column":218}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":28,"column":10},"generated":{"line":1,"column":226}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":28,"column":10},"generated":{"line":1,"column":232}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":28,"column":25},"generated":{"line":1,"column":234}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":28,"column":34},"generated":{"line":1,"column":236}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":29,"column":10},"generated":{"line":1,"column":249}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":29,"column":24},"generated":{"line":1,"column":251}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":29,"column":33},"generated":{"line":1,"column":253}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":30,"column":10},"generated":{"line":1,"column":265}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":30,"column":27},"generated":{"line":1,"column":267}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":30,"column":36},"generated":{"line":1,"column":269}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":31,"column":10},"generated":{"line":1,"column":284}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":31,"column":34},"generated":{"line":1,"column":286}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":31,"column":43},"generated":{"line":1,"column":288}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":32,"column":10},"generated":{"line":1,"column":310}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":32,"column":33},"generated":{"line":1,"column":312}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":32,"column":42},"generated":{"line":1,"column":314}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":34,"column":10},"generated":{"line":1,"column":335}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":34,"column":19},"generated":{"line":1,"column":337}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":34,"column":43},"generated":{"line":1,"column":339}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":34,"column":47},"generated":{"line":1,"column":341}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":34,"column":56},"generated":{"line":1,"column":343}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":34,"column":64},"generated":{"line":1,"column":351}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":35,"column":10},"generated":{"line":1,"column":355}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":35,"column":20},"generated":{"line":1,"column":357}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":35,"column":43},"generated":{"line":1,"column":359}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":35,"column":47},"generated":{"line":1,"column":361}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":35,"column":56},"generated":{"line":1,"column":363}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":35,"column":64},"generated":{"line":1,"column":371}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":37,"column":10},"generated":{"line":1,"column":376}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":37,"column":22},"generated":{"line":1,"column":378}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":37,"column":46},"generated":{"line":1,"column":380}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":37,"column":69},"generated":{"line":1,"column":382}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":38,"column":9},"generated":{"line":1,"column":384}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":38,"column":9},"generated":{"line":1,"column":389}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":39,"column":33},"generated":{"line":1,"column":434}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":39,"column":44},"generated":{"line":1,"column":440}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":53,"column":32},"generated":{"line":1,"column":906}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":54,"column":18},"generated":{"line":1,"column":929}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":55,"column":48},"generated":{"line":1,"column":984}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":57,"column":36},"generated":{"line":1,"column":1029}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":57,"column":45},"generated":{"line":1,"column":1031}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":62,"column":34},"generated":{"line":1,"column":1172}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":63,"column":50},"generated":{"line":1,"column":1235}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":65,"column":38},"generated":{"line":1,"column":1282}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":65,"column":47},"generated":{"line":1,"column":1284}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":72,"column":32},"generated":{"line":1,"column":1499}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":76,"column":37},"generated":{"line":1,"column":1686}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":88,"column":37},"generated":{"line":1,"column":1880}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":88,"column":37},"generated":{"line":1,"column":1888}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":88,"column":37},"generated":{"line":1,"column":1913}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":88,"column":6},"generated":{"line":1,"column":1915}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":88,"column":13},"generated":{"line":1,"column":1921}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":93,"column":2},"generated":{"line":1,"column":1923}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":93,"column":14},"generated":{"line":1,"column":1935}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":89,"column":2},"generated":{"line":1,"column":1938}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":89,"column":2},"generated":{"line":1,"column":1943}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":89,"column":18},"generated":{"line":1,"column":1957}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":89,"column":19},"generated":{"line":1,"column":1958}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":89,"column":25},"generated":{"line":1,"column":1963}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":94,"column":9},"generated":{"line":1,"column":1973}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":94,"column":9},"generated":{"line":1,"column":1978}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":94,"column":23},"generated":{"line":1,"column":1990}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":94,"column":32},"generated":{"line":1,"column":1992}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":95,"column":10},"generated":{"line":1,"column":2000}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":95,"column":10},"generated":{"line":1,"column":2006}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":95,"column":24},"generated":{"line":1,"column":2008}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":95,"column":33},"generated":{"line":1,"column":2010}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":96,"column":10},"generated":{"line":1,"column":2022}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":96,"column":25},"generated":{"line":1,"column":2024}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":96,"column":34},"generated":{"line":1,"column":2026}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":97,"column":10},"generated":{"line":1,"column":2039}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":97,"column":24},"generated":{"line":1,"column":2041}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":97,"column":33},"generated":{"line":1,"column":2043}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":98,"column":10},"generated":{"line":1,"column":2055}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":98,"column":26},"generated":{"line":1,"column":2057}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":98,"column":35},"generated":{"line":1,"column":2059}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":99,"column":10},"generated":{"line":1,"column":2073}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":99,"column":27},"generated":{"line":1,"column":2075}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":99,"column":36},"generated":{"line":1,"column":2077}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":100,"column":10},"generated":{"line":1,"column":2092}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":100,"column":26},"generated":{"line":1,"column":2094}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":100,"column":35},"generated":{"line":1,"column":2096}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":101,"column":10},"generated":{"line":1,"column":2110}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":101,"column":33},"generated":{"line":1,"column":2112}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":101,"column":42},"generated":{"line":1,"column":2114}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":102,"column":10},"generated":{"line":1,"column":2135}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":102,"column":34},"generated":{"line":1,"column":2137}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":102,"column":43},"generated":{"line":1,"column":2139}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":103,"column":10},"generated":{"line":1,"column":2161}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":103,"column":33},"generated":{"line":1,"column":2163}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":103,"column":42},"generated":{"line":1,"column":2165}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":105,"column":10},"generated":{"line":1,"column":2186}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":105,"column":21},"generated":{"line":1,"column":2188}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":105,"column":44},"generated":{"line":1,"column":2190}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":105,"column":48},"generated":{"line":1,"column":2192}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":105,"column":57},"generated":{"line":1,"column":2194}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":105,"column":65},"generated":{"line":1,"column":2202}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":106,"column":10},"generated":{"line":1,"column":2208}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":106,"column":19},"generated":{"line":1,"column":2210}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":106,"column":43},"generated":{"line":1,"column":2212}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":106,"column":47},"generated":{"line":1,"column":2214}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":106,"column":56},"generated":{"line":1,"column":2216}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":106,"column":64},"generated":{"line":1,"column":2224}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":107,"column":10},"generated":{"line":1,"column":2228}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":107,"column":20},"generated":{"line":1,"column":2230}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":107,"column":43},"generated":{"line":1,"column":2232}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":107,"column":47},"generated":{"line":1,"column":2234}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":107,"column":56},"generated":{"line":1,"column":2236}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":107,"column":64},"generated":{"line":1,"column":2244}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":109,"column":10},"generated":{"line":1,"column":2249}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":110,"column":8},"generated":{"line":1,"column":2251}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":110,"column":31},"generated":{"line":1,"column":2253}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":110,"column":55},"generated":{"line":1,"column":2255}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":110,"column":78},"generated":{"line":1,"column":2257}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":111,"column":9},"generated":{"line":1,"column":2259}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":111,"column":9},"generated":{"line":1,"column":2264}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":112,"column":33},"generated":{"line":1,"column":2309}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":112,"column":46},"generated":{"line":1,"column":2315}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":112,"column":57},"generated":{"line":1,"column":2321}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":129,"column":32},"generated":{"line":1,"column":2873}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":130,"column":19},"generated":{"line":1,"column":2897}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":131,"column":48},"generated":{"line":1,"column":2952}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":133,"column":36},"generated":{"line":1,"column":2997}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":133,"column":45},"generated":{"line":1,"column":2999}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":138,"column":34},"generated":{"line":1,"column":3139}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":139,"column":22},"generated":{"line":1,"column":3166}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":140,"column":50},"generated":{"line":1,"column":3223}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":142,"column":38},"generated":{"line":1,"column":3270}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":142,"column":47},"generated":{"line":1,"column":3272}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":148,"column":36},"generated":{"line":1,"column":3438}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":149,"column":24},"generated":{"line":1,"column":3467}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":150,"column":52},"generated":{"line":1,"column":3526}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":152,"column":40},"generated":{"line":1,"column":3575}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":152,"column":49},"generated":{"line":1,"column":3577}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":159,"column":34},"generated":{"line":1,"column":3815}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":165,"column":25},"generated":{"line":1,"column":4057}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":165,"column":52},"generated":{"line":1,"column":4064}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":166,"column":25},"generated":{"line":1,"column":4095}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":88,"column":37},"generated":{"line":1,"column":4308}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":88,"column":37},"generated":{"line":1,"column":4316}},{"source":"../src/max_pool_backprop_gpu.ts","name":null,"original":{"line":88,"column":37},"generated":{"line":1,"column":4341}}],"sources":{"../src/max_pool_backprop_gpu.ts":"/**\n * @license\n * Copyright 2017 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util} from '@tensorflow/tfjs-core';\nimport {GPGPUProgram} from './gpgpu_math';\n\nexport class MaxPool2DBackpropProgram implements GPGPUProgram {\n  variableNames = ['dy', 'maxPos'];\n  outputShape: number[];\n  userCode: string;\n\n  constructor(convInfo: backend_util.Conv2DInfo) {\n    this.outputShape = convInfo.inShape;\n    const strideHeight = convInfo.strideHeight;\n    const strideWidth = convInfo.strideWidth;\n    const dilationHeight = convInfo.dilationHeight;\n    const effectiveFilterHeight = convInfo.effectiveFilterHeight;\n    const effectiveFilterWidth = convInfo.effectiveFilterWidth;\n\n    const padTop = effectiveFilterHeight - 1 - convInfo.padInfo.top;\n    const padLeft = effectiveFilterWidth - 1 - convInfo.padInfo.left;\n\n    const lastIndex = effectiveFilterHeight * effectiveFilterWidth - 1;\n    this.userCode = `\n      const ivec2 pads = ivec2(${padTop}, ${padLeft});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${effectiveFilterHeight};\n          wR += ${dilationHeight}) {\n          float dyR = float(dyRCorner + wR) / ${strideHeight}.0;\n\n          if (dyR < 0.0 || dyR >= ${convInfo.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${effectiveFilterWidth}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${strideWidth}.0;\n\n            if (dyC < 0.0 || dyC >= ${convInfo.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ${lastIndex} - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ${effectiveFilterWidth} + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `;\n  }\n}\n\nexport class MaxPool3DBackpropProgram implements GPGPUProgram {\n  variableNames = ['dy', 'maxPos'];\n  outputShape: number[];\n  userCode: string;\n\n  constructor(convInfo: backend_util.Conv3DInfo) {\n    this.outputShape = convInfo.inShape;\n    const strideDepth = convInfo.strideDepth;\n    const strideHeight = convInfo.strideHeight;\n    const strideWidth = convInfo.strideWidth;\n    const dilationDepth = convInfo.dilationDepth;\n    const dilationHeight = convInfo.dilationHeight;\n    const dilationWidth = convInfo.dilationWidth;\n    const effectiveFilterDepth = convInfo.effectiveFilterDepth;\n    const effectiveFilterHeight = convInfo.effectiveFilterHeight;\n    const effectiveFilterWidth = convInfo.effectiveFilterWidth;\n\n    const padFront = effectiveFilterDepth - 1 - convInfo.padInfo.front;\n    const padTop = effectiveFilterHeight - 1 - convInfo.padInfo.top;\n    const padLeft = effectiveFilterWidth - 1 - convInfo.padInfo.left;\n\n    const lastIndex =\n        effectiveFilterDepth * effectiveFilterHeight * effectiveFilterWidth - 1;\n    this.userCode = `\n      const ivec3 pads = ivec3(${padFront}, ${padTop}, ${padLeft});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${effectiveFilterDepth};\n           wD += ${dilationDepth}) {\n          float dyD = float(dyDCorner + wD) / ${strideDepth}.0;\n\n          if (dyD < 0.0 || dyD >= ${convInfo.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${effectiveFilterHeight};\n              wR += ${dilationHeight}) {\n            float dyR = float(dyRCorner + wR) / ${strideHeight}.0;\n\n            if (dyR < 0.0 || dyR >= ${convInfo.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${effectiveFilterWidth};\n                wC += ${dilationWidth}) {\n              float dyC = float(dyCCorner + wC) / ${strideWidth}.0;\n\n              if (dyC < 0.0 || dyC >= ${convInfo.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ${lastIndex} -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ${effectiveFilterHeight} * ${effectiveFilterWidth} +\n                  wR * ${effectiveFilterWidth} + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `;\n  }\n}\n"},"lineCount":null}},"error":null,"hash":"e055696e7fcacf4895785b592f3d59e8","cacheData":{"env":{}}}