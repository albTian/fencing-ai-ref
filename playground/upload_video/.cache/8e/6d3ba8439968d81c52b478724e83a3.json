{"id":"SBwi","dependencies":[{"name":"/Users/alberttian/f21/playground/frontend/upload_video/node_modules/@tensorflow/tfjs-backend-webgl/dist/slice_gpu.js.map","includedInParent":true,"mtime":1634449894355},{"name":"/Users/alberttian/f21/playground/frontend/upload_video/package.json","includedInParent":true,"mtime":1634449883544},{"name":"/Users/alberttian/f21/playground/frontend/upload_video/.babelrc","includedInParent":true,"mtime":1634449693369},{"name":"/Users/alberttian/f21/playground/frontend/upload_video/node_modules/@tensorflow/tfjs-backend-webgl/package.json","includedInParent":true,"mtime":1634449894355},{"name":"./shader_compiler","loc":{"line":17,"column":34},"parent":"/Users/alberttian/f21/playground/frontend/upload_video/node_modules/@tensorflow/tfjs-backend-webgl/dist/slice_gpu.js","resolved":"/Users/alberttian/f21/playground/frontend/upload_video/node_modules/@tensorflow/tfjs-backend-webgl/dist/shader_compiler.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.SliceProgram=void 0;var t=require(\"./shader_compiler\");class r{constructor(r){this.variableNames=[\"source\"],this.outputShape=r,this.rank=r.length;const s=(0,t.getCoordsDataType)(this.rank),n=`uniform int start[${this.rank}];`,i=e(this.rank);let a;a=`\\n        ${s} sourceLoc;\\n        ${s} coords = getOutputCoords();\\n        ${r.map((t,r)=>`sourceLoc.${o[r]} = start[${r}] + coords.${o[r]};`).join(\"\\n\")}\\n      `,this.userCode=`\\n      ${n}\\n      void main() {\\n        ${a}\\n        setOutput(getSource(${i}));\\n      }\\n    `}getCustomSetupFunc(t){if(t.length!==this.rank)throw Error(`The rank (${this.rank}) of the program must match the `+`length of start (${t.length})`);return(r,o)=>{null==this.startLoc&&(this.startLoc=r.getUniformLocationNoThrow(o,\"start\"),null==this.startLoc)||r.gl.uniform1iv(this.startLoc,t)}}}exports.SliceProgram=r;const o=[\"x\",\"y\",\"z\",\"w\",\"u\",\"v\"];function e(t){if(1===t)return\"sourceLoc\";if(t<=6)return o.slice(0,t).map(t=>\"sourceLoc.\"+t).join(\",\");throw Error(`Slicing for rank ${t} is not yet supported`)}"},"sourceMaps":{"js":{"mappings":[{"source":"../src/slice_gpu.ts","name":null,"original":{"line":87,"column":1},"generated":{"line":1,"column":0}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":87,"column":1},"generated":{"line":1,"column":13}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":87,"column":1},"generated":{"line":1,"column":20}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":87,"column":1},"generated":{"line":1,"column":35}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":87,"column":1},"generated":{"line":1,"column":43}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":87,"column":1},"generated":{"line":1,"column":56}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":87,"column":1},"generated":{"line":1,"column":57}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":87,"column":1},"generated":{"line":1,"column":64}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":87,"column":1},"generated":{"line":1,"column":68}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":87,"column":1},"generated":{"line":1,"column":76}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":87,"column":1},"generated":{"line":1,"column":94}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":20,"column":0},"generated":{"line":1,"column":96}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":20,"column":0},"generated":{"line":1,"column":100}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":20,"column":0},"generated":{"line":1,"column":102}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":20,"column":0},"generated":{"line":1,"column":110}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":22,"column":6},"generated":{"line":1,"column":131}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":22,"column":13},"generated":{"line":1,"column":137}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":31,"column":2},"generated":{"line":1,"column":139}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":31,"column":14},"generated":{"line":1,"column":151}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":23,"column":2},"generated":{"line":1,"column":154}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":23,"column":2},"generated":{"line":1,"column":159}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":23,"column":18},"generated":{"line":1,"column":173}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":23,"column":19},"generated":{"line":1,"column":174}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":32,"column":9},"generated":{"line":1,"column":184}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":32,"column":9},"generated":{"line":1,"column":189}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":32,"column":23},"generated":{"line":1,"column":201}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":33,"column":9},"generated":{"line":1,"column":203}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":33,"column":9},"generated":{"line":1,"column":208}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":33,"column":16},"generated":{"line":1,"column":213}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":33,"column":25},"generated":{"line":1,"column":215}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":35,"column":10},"generated":{"line":1,"column":222}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":35,"column":10},"generated":{"line":1,"column":228}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":35,"column":18},"generated":{"line":1,"column":231}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":35,"column":36},"generated":{"line":1,"column":233}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":35,"column":36},"generated":{"line":1,"column":235}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":35,"column":36},"generated":{"line":1,"column":254}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":35,"column":41},"generated":{"line":1,"column":259}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":36,"column":10},"generated":{"line":1,"column":265}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":36,"column":45},"generated":{"line":1,"column":288}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":36,"column":50},"generated":{"line":1,"column":293}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":37,"column":10},"generated":{"line":1,"column":302}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":37,"column":25},"generated":{"line":1,"column":304}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":37,"column":35},"generated":{"line":1,"column":306}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":37,"column":40},"generated":{"line":1,"column":311}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":39,"column":8},"generated":{"line":1,"column":317}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":39,"column":8},"generated":{"line":1,"column":321}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":43,"column":4},"generated":{"line":1,"column":323}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":44,"column":10},"generated":{"line":1,"column":338}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":45,"column":10},"generated":{"line":1,"column":363}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":40,"column":21},"generated":{"line":1,"column":405}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":40,"column":30},"generated":{"line":1,"column":407}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":40,"column":34},"generated":{"line":1,"column":411}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":40,"column":35},"generated":{"line":1,"column":412}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":40,"column":38},"generated":{"line":1,"column":414}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":41,"column":26},"generated":{"line":1,"column":431}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":41,"column":33},"generated":{"line":1,"column":433}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":41,"column":47},"generated":{"line":1,"column":447}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":41,"column":62},"generated":{"line":1,"column":462}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":41,"column":69},"generated":{"line":1,"column":464}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":46,"column":19},"generated":{"line":1,"column":471}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":46,"column":24},"generated":{"line":1,"column":476}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":48,"column":9},"generated":{"line":1,"column":492}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":48,"column":9},"generated":{"line":1,"column":497}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":49,"column":8},"generated":{"line":1,"column":517}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":51,"column":10},"generated":{"line":1,"column":552}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":52,"column":30},"generated":{"line":1,"column":586}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":57,"column":2},"generated":{"line":1,"column":608}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":57,"column":21},"generated":{"line":1,"column":627}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":58,"column":8},"generated":{"line":1,"column":630}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":58,"column":8},"generated":{"line":1,"column":633}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":58,"column":14},"generated":{"line":1,"column":635}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":58,"column":25},"generated":{"line":1,"column":644}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":58,"column":30},"generated":{"line":1,"column":649}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":59,"column":12},"generated":{"line":1,"column":654}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":59,"column":12},"generated":{"line":1,"column":660}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":60,"column":23},"generated":{"line":1,"column":679}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":60,"column":28},"generated":{"line":1,"column":684}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":61,"column":30},"generated":{"line":1,"column":743}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":61,"column":36},"generated":{"line":1,"column":745}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":63,"column":11},"generated":{"line":1,"column":756}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":63,"column":11},"generated":{"line":1,"column":762}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":63,"column":12},"generated":{"line":1,"column":763}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":63,"column":33},"generated":{"line":1,"column":765}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":64,"column":27},"generated":{"line":1,"column":770}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":64,"column":10},"generated":{"line":1,"column":776}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":64,"column":15},"generated":{"line":1,"column":781}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":65,"column":13},"generated":{"line":1,"column":792}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":65,"column":13},"generated":{"line":1,"column":797}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":65,"column":24},"generated":{"line":1,"column":806}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":65,"column":30},"generated":{"line":1,"column":808}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":65,"column":56},"generated":{"line":1,"column":834}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":65,"column":70},"generated":{"line":1,"column":836}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":66,"column":29},"generated":{"line":1,"column":845}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":66,"column":12},"generated":{"line":1,"column":851}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":66,"column":17},"generated":{"line":1,"column":856}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":72,"column":6},"generated":{"line":1,"column":867}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":72,"column":12},"generated":{"line":1,"column":869}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":72,"column":15},"generated":{"line":1,"column":872}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":72,"column":26},"generated":{"line":1,"column":883}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":72,"column":31},"generated":{"line":1,"column":888}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":72,"column":41},"generated":{"line":1,"column":897}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":87,"column":1},"generated":{"line":1,"column":902}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":87,"column":1},"generated":{"line":1,"column":910}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":87,"column":1},"generated":{"line":1,"column":923}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":77,"column":0},"generated":{"line":1,"column":925}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":77,"column":6},"generated":{"line":1,"column":931}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":77,"column":15},"generated":{"line":1,"column":933}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":77,"column":16},"generated":{"line":1,"column":934}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":77,"column":21},"generated":{"line":1,"column":938}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":77,"column":26},"generated":{"line":1,"column":942}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":77,"column":31},"generated":{"line":1,"column":946}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":77,"column":36},"generated":{"line":1,"column":950}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":77,"column":41},"generated":{"line":1,"column":954}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":79,"column":0},"generated":{"line":1,"column":959}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":79,"column":9},"generated":{"line":1,"column":968}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":79,"column":19},"generated":{"line":1,"column":970}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":80,"column":6},"generated":{"line":1,"column":973}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":80,"column":15},"generated":{"line":1,"column":976}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":80,"column":6},"generated":{"line":1,"column":980}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":81,"column":11},"generated":{"line":1,"column":982}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":81,"column":11},"generated":{"line":1,"column":988}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":82,"column":9},"generated":{"line":1,"column":1000}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":82,"column":13},"generated":{"line":1,"column":1003}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":82,"column":21},"generated":{"line":1,"column":1006}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":83,"column":11},"generated":{"line":1,"column":1008}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":83,"column":11},"generated":{"line":1,"column":1015}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":83,"column":18},"generated":{"line":1,"column":1017}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":83,"column":24},"generated":{"line":1,"column":1023}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":83,"column":27},"generated":{"line":1,"column":1025}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":83,"column":33},"generated":{"line":1,"column":1028}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":83,"column":37},"generated":{"line":1,"column":1032}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":83,"column":42},"generated":{"line":1,"column":1035}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":83,"column":57},"generated":{"line":1,"column":1048}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":83,"column":60},"generated":{"line":1,"column":1051}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":83,"column":65},"generated":{"line":1,"column":1056}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":85,"column":10},"generated":{"line":1,"column":1061}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":85,"column":10},"generated":{"line":1,"column":1067}},{"source":"../src/slice_gpu.ts","name":null,"original":{"line":85,"column":36},"generated":{"line":1,"column":1093}}],"sources":{"../src/slice_gpu.ts":"/**\n * @license\n * Copyright 2017 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {GPGPUContext} from './gpgpu_context';\nimport {GPGPUProgram} from './gpgpu_math';\nimport {getCoordsDataType} from './shader_compiler';\n\nexport class SliceProgram implements GPGPUProgram {\n  variableNames = ['source'];\n  outputShape: number[];\n  userCode: string;\n  rank: number;\n\n  // Caching uniform location for speed.\n  startLoc: WebGLUniformLocation;\n\n  constructor(destSize: number[]) {\n    this.outputShape = destSize;\n    this.rank = destSize.length;\n\n    const dtype = getCoordsDataType(this.rank);\n    const uniformPart = `uniform int start[${this.rank}];`;\n    const sourceCoords = getCoords(this.rank);\n\n    let body: string;\n    const coordSum = destSize.map((_, i) => {\n      return `sourceLoc.${coords[i]} = start[${i}] + coords.${coords[i]};`;\n    });\n    body = `\n        ${dtype} sourceLoc;\n        ${dtype} coords = getOutputCoords();\n        ${coordSum.join('\\n')}\n      `;\n    this.userCode = `\n      ${uniformPart}\n      void main() {\n        ${body}\n        setOutput(getSource(${sourceCoords}));\n      }\n    `;\n  }\n\n  getCustomSetupFunc(start: number[]) {\n    if (start.length !== this.rank) {\n      throw Error(\n          `The rank (${this.rank}) of the program must match the ` +\n          `length of start (${start.length})`);\n    }\n    return (gpgpu: GPGPUContext, webGLProgram: WebGLProgram) => {\n      if (this.startLoc == null) {\n        this.startLoc = gpgpu.getUniformLocationNoThrow(webGLProgram, 'start');\n        if (this.startLoc == null) {\n          // This means the compiler has optimized and realized it doesn't need\n          // the uniform.\n          return;\n        }\n      }\n      gpgpu.gl.uniform1iv(this.startLoc, start);\n    };\n  }\n}\n\nconst coords = ['x', 'y', 'z', 'w', 'u', 'v'];\n\nfunction getCoords(rank: number): string {\n  if (rank === 1) {\n    return 'sourceLoc';\n  } else if (rank <= 6) {\n    return coords.slice(0, rank).map(x => 'sourceLoc.' + x).join(',');\n  } else {\n    throw Error(`Slicing for rank ${rank} is not yet supported`);\n  }\n}\n"},"lineCount":null}},"error":null,"hash":"035934063b0d1a2da82275f501093ee8","cacheData":{"env":{}}}